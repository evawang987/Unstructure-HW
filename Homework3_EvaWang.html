<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eva Wang">

<title>Homework 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Homework 3_files/libs/clipboard/clipboard.min.js"></script>
<script src="Homework 3_files/libs/quarto-html/quarto.js"></script>
<script src="Homework 3_files/libs/quarto-html/popper.min.js"></script>
<script src="Homework 3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Homework 3_files/libs/quarto-html/anchor.min.js"></script>
<link href="Homework 3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Homework 3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Homework 3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Homework 3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Homework 3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 3</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Eva Wang </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>Prompt: Likely the easiest homework ever. You have exactly one task: use your text from homework #2 to create any model that you want. It doesn’t matter what model you choose, as long as it makes sense. Discuss your rationale and your results.</p>
<section id="xgboost-winner-winner-chicken-dinner" class="level1">
<h1>XGBoost: winner winner, chicken dinner</h1>
<section id="import-data" class="level2">
<h2 class="anchored" data-anchor-id="import-data">Import Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>congress_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/Documents/Mod 3/Unstructured Data Analytics/Homework/Homework 2/congress_df.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>party_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">party =</span> congress_df<span class="sc">$</span>Latest_Party,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">document =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(congress_df)))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>party_data <span class="ot">&lt;-</span> party_data[<span class="sc">!</span>party_data<span class="sc">$</span>party<span class="sc">==</span><span class="st">'Independent'</span>,] <span class="co"># for my sanity, drop the independent guy</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>party_data<span class="sc">$</span>party <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(party_data<span class="sc">$</span>party)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>profile_dtm <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/Documents/Mod 3/Unstructured Data Analytics/Homework/Homework 2/profile_dtm.rds"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>profile_dtm <span class="ot">&lt;-</span> <span class="fu">tidy</span>(profile_dtm) <span class="co"># convert to df</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>profile_dtm <span class="ot">&lt;-</span> profile_dtm <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> count)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>total_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> party_data, <span class="at">y =</span> profile_dtm, <span class="at">by =</span> <span class="st">"document"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>total_data <span class="ot">&lt;-</span> total_data[,<span class="sc">-</span><span class="dv">1</span>] <span class="co"># remove document</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(total_data)[<span class="fu">colnames</span>(total_data)<span class="sc">==</span><span class="st">'party.x'</span>] <span class="ot">&lt;-</span> <span class="st">"party_dv"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(total_data)[<span class="fu">colnames</span>(total_data)<span class="sc">==</span><span class="st">'party.y'</span>] <span class="ot">&lt;-</span> <span class="st">"party"</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(total_data<span class="sc">$</span>party_dv) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  Democrat Republican 
       115        125 </code></pre>
</div>
</div>
</section>
<section id="data-partition" class="level2">
<h2 class="anchored" data-anchor-id="data-partition">Data Partition</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>total_obs <span class="ot">&lt;-</span> <span class="fu">dim</span>(total_data)[<span class="dv">1</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Data Partition: Training v.s. Test split</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>train_data_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>total_obs, <span class="fl">0.8</span><span class="sc">*</span>total_obs)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> total_data[train_data_indices,]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> total_data[<span class="sc">-</span>train_data_indices,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost---show-your-magic" class="level2">
<h2 class="anchored" data-anchor-id="xgboost---show-your-magic">XGBoost - Show your Magic</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(OptimalCutpoints)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboostExplainer) </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SHAPforxgboost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="convert-data-to-dmatrix" class="level3">
<h3 class="anchored" data-anchor-id="convert-data-to-dmatrix">Convert data to DMatrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training matrix</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(train_data[, <span class="dv">2</span><span class="sc">:</span><span class="dv">1515</span>]), <span class="at">label =</span> <span class="fu">as.numeric</span>(train_data<span class="sc">$</span>party_dv) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create test matrix</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(test_data[, <span class="dv">2</span><span class="sc">:</span><span class="dv">1515</span>]), <span class="at">label =</span> <span class="fu">as.numeric</span>(test_data<span class="sc">$</span>party_dv) <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train-model" class="level3">
<h3 class="anchored" data-anchor-id="train-model">Train Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111111</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>bst_1 <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> dtrain, <span class="co"># Set training data</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">nrounds =</span> <span class="dv">100</span>, <span class="co"># Set number of rounds</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="dv">1</span>, <span class="co"># 1 - Prints out fit</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">print_every_n =</span> <span class="dv">20</span>, <span class="co"># Prints out result every 20th iteration</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="co"># Set objective</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">eval_metric =</span> <span class="st">"auc"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">eval_metric =</span> <span class="st">"error"</span>) <span class="co"># Set evaluation metric to use</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:1.000000  train-error:0.000000 
[21]    train-auc:1.000000  train-error:0.000000 
[41]    train-auc:1.000000  train-error:0.000000 
[61]    train-auc:1.000000  train-error:0.000000 
[81]    train-auc:1.000000  train-error:0.000000 
[100]   train-auc:1.000000  train-error:0.000000 </code></pre>
</div>
</div>
</section>
<section id="predicting-with-xgboost" class="level3">
<h3 class="anchored" data-anchor-id="predicting-with-xgboost">Predicting with XGBoost</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>boost_preds_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bst_1, dtest) <span class="co"># Create predictions for xgboost model</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pred_dat <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(boost_preds_1 , test_data<span class="sc">$</span>party_dv) </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert predictions to classes, using optimal cut-off</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>boost_pred_class <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"Democrat"</span>, <span class="fu">length</span>(boost_preds_1))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>boost_pred_class[boost_preds_1 <span class="sc">&gt;=</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Republican"</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>t_xgb <span class="ot">&lt;-</span> <span class="fu">table</span>(boost_pred_class, test_data<span class="sc">$</span>party_dv) <span class="co"># Create table</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>xgb_acc <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(t_xgb, <span class="at">positive =</span> <span class="st">"Republican"</span>) <span class="co"># Produce confusion matrix</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>xgb_acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

                
boost_pred_class Democrat Republican
      Democrat         25          0
      Republican        0         23
                                    
               Accuracy : 1         
                 95% CI : (0.926, 1)
    No Information Rate : 0.5208    
    P-Value [Acc &gt; NIR] : 2.521e-14 
                                    
                  Kappa : 1         
                                    
 Mcnemar's Test P-Value : NA        
                                    
            Sensitivity : 1.0000    
            Specificity : 1.0000    
         Pos Pred Value : 1.0000    
         Neg Pred Value : 1.0000    
             Prevalence : 0.4792    
         Detection Rate : 0.4792    
   Detection Prevalence : 0.4792    
      Balanced Accuracy : 1.0000    
                                    
       'Positive' Class : Republican
                                    </code></pre>
</div>
</div>
<p>Maybe I am a genius to develop a perfectly accurate model in first try. I am very bless. Thank you and thank you.</p>
<p>However, there is always a “however”. Some of the variables actually tells us their parties. Considering that cheating is not recommended. Let’s remove those and see how XGBoost will adapt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(total_data)[<span class="fu">grep</span>(<span class="st">"demo"</span>, <span class="fu">colnames</span>(total_data))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "democrat"   "democratic"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(total_data)[<span class="fu">grep</span>(<span class="st">"repub"</span>, <span class="fu">colnames</span>(total_data))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "republican" "republic"  </code></pre>
</div>
</div>
</section>
</section>
<section id="xgboost-round-2-no-cheating" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-round-2-no-cheating">XGBoost Round 2: No Cheating</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>total_data2 <span class="ot">&lt;-</span> total_data[, <span class="sc">-</span><span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"demo"</span>, <span class="fu">colnames</span>(total_data)), <span class="fu">grep</span>(<span class="st">"repub"</span>, <span class="fu">colnames</span>(total_data)))]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>train_data2 <span class="ot">&lt;-</span> train_data[, <span class="sc">-</span><span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"demo"</span>, <span class="fu">colnames</span>(train_data)), <span class="fu">grep</span>(<span class="st">"repub"</span>, <span class="fu">colnames</span>(train_data)))]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>test_data2 <span class="ot">&lt;-</span> test_data[, <span class="sc">-</span><span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"demo"</span>, <span class="fu">colnames</span>(test_data)), <span class="fu">grep</span>(<span class="st">"repub"</span>, <span class="fu">colnames</span>(test_data)))]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to matrix</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>dtrain2 <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(train_data2[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(train_data2)]), <span class="at">label =</span> <span class="fu">as.numeric</span>(train_data2<span class="sc">$</span>party_dv) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>dtest2 <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(test_data2[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(test_data2)]), <span class="at">label =</span> <span class="fu">as.numeric</span>(test_data2<span class="sc">$</span>party_dv) <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111111</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>bst_2 <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> dtrain2, <span class="co"># Set training data</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">nrounds =</span> <span class="dv">100</span>, <span class="co"># Set number of rounds</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">verbose =</span> <span class="dv">1</span>, <span class="co"># 1 - Prints out fit</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">print_every_n =</span> <span class="dv">20</span>, <span class="co"># Prints out result every 20th iteration</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">objective =</span> <span class="st">"binary:logistic"</span>, <span class="co"># Set objective</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">eval_metric =</span> <span class="st">"auc"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">eval_metric =</span> <span class="st">"error"</span>) <span class="co"># Set evaluation metric to use</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.932190  train-error:0.104167 
[21]    train-auc:1.000000  train-error:0.000000 
[41]    train-auc:1.000000  train-error:0.000000 
[61]    train-auc:1.000000  train-error:0.000000 
[81]    train-auc:1.000000  train-error:0.000000 
[100]   train-auc:1.000000  train-error:0.000000 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>boost_preds_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(bst_2, dtest2) <span class="co"># Create predictions for xgboost model</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>pred_dat2 <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(boost_preds_2 , test_data2<span class="sc">$</span>party_dv) </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert predictions to classes, using optimal cut-off</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>boost_pred_class <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"Democrat"</span>, <span class="fu">length</span>(boost_preds_1))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>boost_pred_class[boost_preds_1 <span class="sc">&gt;=</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="st">"Republican"</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>t_xgb2 <span class="ot">&lt;-</span> <span class="fu">table</span>(boost_pred_class, test_data2<span class="sc">$</span>party_dv) <span class="co"># Create table</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>xgb_acc2 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(t_xgb2, <span class="at">positive =</span> <span class="st">"Republican"</span>) <span class="co"># Produce confusion matrix</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>xgb_acc2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

                
boost_pred_class Democrat Republican
      Democrat         25          0
      Republican        0         23
                                    
               Accuracy : 1         
                 95% CI : (0.926, 1)
    No Information Rate : 0.5208    
    P-Value [Acc &gt; NIR] : 2.521e-14 
                                    
                  Kappa : 1         
                                    
 Mcnemar's Test P-Value : NA        
                                    
            Sensitivity : 1.0000    
            Specificity : 1.0000    
         Pos Pred Value : 1.0000    
         Neg Pred Value : 1.0000    
             Prevalence : 0.4792    
         Detection Rate : 0.4792    
   Detection Prevalence : 0.4792    
      Balanced Accuracy : 1.0000    
                                    
       'Positive' Class : Republican
                                    </code></pre>
</div>
</div>
<p>Okay, I probably am a genius at the end of the day.</p>
</section>
</section>
<section id="topic-model" class="level1">
<h1>Topic Model</h1>
<p>Okay, predicting party is kinda of cheating in general. Let’s look at states, which should be more complex…</p>
<p>In my homework 2, I didn’t use the entire data frame to construct <code>corpus</code>. Thus, I need to repeat the process with the entire data. Now, in <code>congress_df</code> data frame, I have the Profile column as the original profile text from the website and the Text column as the cleaned version with numbers, punctuation, and stop words dropped (for detailed code, please consult homework 2).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stm)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>profile_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(congress_df, <span class="at">text_field =</span> <span class="st">"text"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>profile_token <span class="ot">&lt;-</span> <span class="fu">tokens</span>(profile_corpus)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>profile_dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(profile_token)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>profile_dfm <span class="ot">&lt;-</span> <span class="fu">dfm_trim</span>(profile_dfm, <span class="at">sparsity =</span> <span class="fl">0.990</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>profile_stm <span class="ot">&lt;-</span> <span class="fu">convert</span>(profile_dfm, <span class="at">to =</span> <span class="st">"stm"</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>docs_stm <span class="ot">&lt;-</span> profile_stm<span class="sc">$</span>documents </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>vocab_stm <span class="ot">&lt;-</span> profile_stm<span class="sc">$</span>vocab    </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>meta_stm <span class="ot">&lt;-</span> profile_stm<span class="sc">$</span>meta</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>profilePrep <span class="ot">&lt;-</span> <span class="fu">prepDocuments</span>(<span class="at">documents =</span> docs_stm, </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">vocab =</span> vocab_stm,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">meta =</span> meta_stm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="topic-model-1" class="level2">
<h2 class="anchored" data-anchor-id="topic-model-1">Topic Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stm)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>kTest <span class="ot">&lt;-</span> <span class="fu">searchK</span>(<span class="at">documents =</span> profilePrep<span class="sc">$</span>documents, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">vocab =</span> profilePrep<span class="sc">$</span>vocab, </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">K =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>), <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Back in Topic Models notes, we discussed that semantic coherence and residuals are better indicators in determining the number of K. We want to have low residual and high semantic coherence. With the elbow method, I noticed that the residual has a sharp turn at around 10. As for semantic coherence, there is a little bit ups and downs. But the pick the highest coherence, I believe 10 clusters will be optimal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>topics10 <span class="ot">&lt;-</span> <span class="fu">stm</span>(<span class="at">documents =</span> profilePrep<span class="sc">$</span>documents, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">vocab =</span> profilePrep<span class="sc">$</span>vocab, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">1001</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">K =</span> <span class="dv">10</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(topics10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">labelTopics</span>(topics10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Topic 1 Top Words:
     Highest Prob: candidate, unsuccessful, congress, hundred, january, state, county 
     FREX: unsuccessful, candidate, nomination, el, paso, executive, election 
     Lift: crux, el, paso, westchester, nonprofit, realtor, communication 
     Score: el, paso, mex, crux, tex, unsuccessful, las 
Topic 2 Top Words:
     Highest Prob: state, representative, congress, mass, hundred, unite, election 
     FREX: mass, cause, fill, vacancy, special, election, boston 
     Lift: buffalo, cause, fill, vacancy, meehan, utica, boston 
     Score: buffalo, mass, boston, cause, fill, vacancy, special 
Topic 3 Top Words:
     Highest Prob: ill, chicago, congress, representative, hundred, january, county 
     FREX: chicago, ill, cook, peoria, evanston, madison, professor 
     Lift: kalb, urbana, northwestern, cook, peoria, chicago, ill 
     Score: ill, kalb, chicago, cook, peoria, evanston, madison 
Topic 4 Top Words:
     Highest Prob: january, senator, elect, graduate, senate, term, college 
     FREX: term, senator, end, queen, serve, governor, counsel 
     Lift: dartmouth, hanover, penn, commence, queen, presidential, lieutenant 
     Score: dartmouth, term, end, hanover, commence, penn, senator 
Topic 5 Top Words:
     Highest Prob: tex, hundred, congress, january, representative, county, houston 
     FREX: tex, houston, dallas, worth, austin, fort, harris 
     Lift: arlington, worth, lubbock, waco, lennan, ala, fla 
     Score: worth, tex, houston, austin, fort, dallas, lubbock 
Topic 6 Top Words:
     Highest Prob: pa, philadelphia, state, representative, hundred, january, congress 
     FREX: pa, philadelphia, pittsburgh, park, allegheny, la, chester 
     Lift: carlisle, chester, dickinson, pittsburgh, pa, salle, wharton 
     Score: pa, carlisle, philadelphia, pittsburgh, chester, allegheny, salle 
Topic 7 Top Words:
     Highest Prob: state, unite, staff, january, hundred, republican, representative 
     FREX: staff, unite, attorney, academy, general, republican, island 
     Lift: lewiston, london, island, phil, vice, gramm, philip 
     Score: lewiston, staff, london, senator, republican, general, academy 
Topic 8 Top Words:
     Highest Prob: hundred, congress, committee, january, chair, city, state 
     FREX: committee, springfield, chair, city, bronx, assembly, economic 
     Lift: springfield, bronx, lehman, hartford, mean, way, economic 
     Score: springfield, bronx, joint, committee, economic, city, chair 
Topic 9 Top Words:
     Highest Prob: state, congress, representative, hundred, mex, unite, democrat 
     FREX: mex, stanford, calif, albuquerque, district, trump, president 
     Lift: fe, santa, vega, albuquerque, select, stanford, highland 
     Score: vega, mex, albuquerque, stanford, fe, santa, las 
Topic 10 Top Words:
     Highest Prob: ind, representative, county, state, congress, dame, notre 
     FREX: ind, dame, notre, bend, south, ndash, indianapolis 
     Lift: broke, bend, dame, notre, ind, bloomington, hempstead 
     Score: broke, ind, dame, notre, bend, south, indianapolis </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findThoughts</span>(topics10, <span class="at">texts =</span> profilePrep<span class="sc">$</span>meta<span class="sc">$</span>Profile, <span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Topic 1: 
     a Representative from New Mexico; born in El Paso, El Paso County, Texas, August 3, 1984; graduated from Montwood High School, El Paso, Texas; B.A., New Mexico State University, Las Cruces, N. Mex., 2008; newspaper editor; nonprofit executive; executive director, Hispanic Chamber of Commerce, Las Cruces, N. Mex., 2011; staff, United States Senator Martin Heinrich of New Mexico, 2013-2015; member of the Las Cruces, N. Mex., city council, 2017-2021; elected as a Democrat to the One Hundred Eighteenth Congress (January 3, 2023-present). 
 Topic 2: 
     A Representative from Massachusetts; born in Boston, Suffolk County, Mass., March 31, 1955; graduated from South Boston High School, Boston, Mass., 1973; B.S., Wentworth Institute, Boston, Mass., 1988; J.D., Boston College, Chestnut Hill, Mass., 1991; M.A., Harvard University, Cambridge, Mass., 1998; member of the Massachusetts state house of representatives, 1995-1996; member of the Massachusetts state senate, 1997-2001; elected as a Democrat to the One Hundred Seventh Congress, by special election, to fill the vacancy caused by the death of United States Representative Joseph Moakley, and reelected to the eleven succeeding Congresses (October 16, 2001-present). 
 Topic 3: 
     a Representative from Illinois; born in Parkdale, Ashley County, Ark., September 6, 1941; graduated from Savage High School, Parkdale, Ark., 1957; B.A., Arkansas A.M.&amp;amp;N. College, Pine Bluff, Ark., 1961; M.S., Chicago State University, Chicago, Ill., 1968; Ph.D., Union Institute, Cincinnati, Ohio, 1977; clerk, Chicago, Ill., Post Office, 1961-1965; teacher, Chicago, Ill., public schools, 1962-1968; executive director, Greater Lawndale Conservation Commission, 1969; director of training, Martin L. King Neighborhood Health Center, 1969-1971; executive director, Westside Health Planning Organization, 1975-1981; alderman, Chicago, Ill., city council, 1979-1990; commissioner, Cook County, Ill., board, 1990-1996; college professor; unsuccessful candidate for nomination to the Ninety-Ninth Congress in 1984; unsuccessful candidate for nomination to the One Hundredth Congress in 1986; elected as a Democrat to the One Hundred Fifth and to the thirteen succeeding Congresses (January 3, 1997-present). 
 Topic 4: 
     a Senator from Pennsylvania; born in Reading, Penn., August 15, 1969; graduated Central York High School, York, Penn., 1987; B.A., business administration, Albright College, Reading, Penn., 1991; M.B.A., University of Connecticut, 1993; M.P.P., Kennedy School of Government, Harvard University, 1999; insurance underwriter; social worker; non-profit organization founder; mayor of Braddock, Penn., 2006-2019; lieutenant governor of Pennsylvania 2019-2023; elected as a Democrat to the United States Senate in 2022 for the term ending January 3, 2029. 
 Topic 5: 
     A Representative from Texas; born in Greenville, Hunt County, Tex., January 18, 1943; graduated from Eastern Hills High School, Fort Worth, Tex.; B.S., Texas Wesleyan University, Fort Worth, Tex., 1965; teacher; business owner; member of the Fort Worth, Tex., zoning commission, 1981-1989; member of the Fort Worth, Tex., city council, 1989-1991; mayor of Fort Worth, Tex., 1991-1995; elected as a Republican to the One Hundred Fifth and to the thirteen succeeding Congresses (January 3, 1997-present); chair, Committee on Appropriations (One Hundred Eighteenth Congress). 
 Topic 6: 
     a Representative from Pennsylvania; born in Philadelphia, Philadelphia County, Pa., June 6, 1959; graduated from Abington High School, Abington, Pa., 1977; attended Montgomery County College, Blue Bell, Pa.; attended Fels Institute of Government, University of Pennsylvania, Philadelphia, Pa.; B.A., La Salle University, Philadelphia, Pa., 1981; J.D., Widener University Delaware Law School, Chester, Pa., 1984; lawyer, private practice; faculty, La Salle University, Philadelphia, Pa., 2001-2012; columnist; member of the Pennsylvania state house of representatives, 2012-2018; elected as a Democrat to the One Hundred Sixteenth and to the two succeeding Congresses (January 3, 2019-present); one of the managers appointed by the House of Representatives in 2021 to conduct the impeachment proceedings of Donald J. Trump, President of the United States. 
 Topic 7: 
     A Senator and a Representative from Idaho; born in Idaho Falls, Bonneville County, Idaho, May 20, 1951; graduated Idaho Falls High School 1969; B.A., Brigham Young University 1973; J.D., Harvard University School of Law 1977; admitted to the bar in 1977; law clerk to Judge James M. Carter, United States Court of Appeals, Ninth Circuit 1977-1978; practiced law in San Diego 1978-1979, and in Idaho Falls 1979-1992; vice chair, Bonneville County Republican Committee 1979-1981; vice chair, Legislative District 29 Republican Committee 1982-1984; Idaho State senator 1985-1992; elected as a Republican to the One Hundred Third and to the two succeeding Congresses (January 3, 1993-January 3, 1999); was not a candidate for reelection to the U.S. House of Representatives, but was elected to the United States Senate in 1998; reelected in 2004, 2010, 2016, and again in 2022 for the term ending January 3, 2029; chair, Committee on Banking, Housing and Urban Affairs (One Hundred Fifteenth and One Hundred Sixteenth Congresses). 
 Topic 8: 
     a Representative from New York; born in Greensboro, Guilford County, N.C., February 19, 1946; B.A., Greensboro College, Greensboro, N.C., 1968; community affairs coordinator, New York, N.Y., board of education welfare education program, 1972-1975; staff, New York, N.Y., board of education center for career and occupational education, 1975-1976; staff, New York state assembly committee on housing, 1977; senior program analyst, New York state assembly committee on cities, 1977-1979; executive director, advisory council, office of the New York state senate minority leader, 1979-1982; director of special projects, office of the New York state senate minority leader, 1980-1982; member of the New York, N.Y., city council, 1982-1992; elected as a Democrat to the One Hundred Third and to the fourteen succeeding Congresses (January 3, 1993-January 3, 2023); unsuccessful candidate for renomination to the One Hundred Eighteenth Congress in 2022; chair, Joint Economic Committee (One Hundred Eleventh Congress); chair, Committee on Oversight and Reform (One Hundred Sixteenth and One Hundred Seventeenth Congresses). 
 Topic 9: 
     a Representative from New Mexico; born in Las Vegas, San Miguel County, N. Mex., July 1, 1959; graduated from West Las Vegas High School, Las Vegas, N. Mex., 1977; A.B., Yale University, New Haven, Conn., 1982; J.D. Stanford University, Stanford, Calif., 1987; lawyer, private practice; White House fellow during the William J. Clinton administration; elected as a Democrat to the One Hundred Seventeenth and to the succeeding Congress (January 3, 2021-present). 
 Topic 10: 
     A Representative from Indiana; born in Columbia City, Whitley County, Ind., July 16, 1979; graduated from Columbia City High School, Columbia City, Ind., 1997; B.A., Indiana University, Bloomington, Ind., 2004; M.B.A., Grace College and Seminary, Winona Lake, Ind., 2013; United States Navy Reserve, 2012-present, Afghanistan War Veteran, 2014-2015; commercial real estate broker; chairman, Whitley County, Ind., Republican Party, 2007-2011; member of the Whitley County, Ind. Council, 2008-2010; member of the Indiana state senate, 2010-2016; elected as a Republican to the One Hundred Fifteenth and to the three succeeding Congresses (January 3, 2017-present).</code></pre>
</div>
</div>
<p>Now, with this, let’s see if we can predict their party and state just based on their profile text.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>profile_df <span class="ot">&lt;-</span> <span class="fu">convert</span>(profile_dfm, <span class="at">to =</span> <span class="st">"data.frame"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(topics10<span class="sc">$</span>theta, meta_stm<span class="sc">$</span>Latest_State))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(model_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"topic_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="st">"State"</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>topic_cols <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">grepl</span>(<span class="st">"topic"</span>, <span class="fu">colnames</span>(model_data)))</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>model_data[, topic_cols] <span class="ot">&lt;-</span> <span class="fu">apply</span>(model_data[, topic_cols], <span class="dv">2</span>, as.numeric)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>model_data<span class="sc">$</span>State <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(model_data<span class="sc">$</span>State)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create learning task</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>state_task <span class="ot">&lt;-</span> TaskClassif<span class="sc">$</span><span class="fu">new</span>(<span class="at">id =</span> <span class="st">"profile"</span>, <span class="at">backend =</span> model_data, <span class="at">target =</span> <span class="st">"State"</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>state_task</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:profile&gt; (241 x 11)
* Target: State
* Properties: multiclass
* Features (10):
  - dbl (10): topic_1, topic_10, topic_2, topic_3, topic_4, topic_5,
    topic_6, topic_7, topic_8, topic_9</code></pre>
</div>
</div>
</section>
<section id="test-state" class="level2">
<h2 class="anchored" data-anchor-id="test-state">Test State</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Partition</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>train_state <span class="ot">&lt;-</span> <span class="fu">sample</span>(state_task<span class="sc">$</span>nrow, <span class="fl">0.8</span> <span class="sc">*</span> state_task<span class="sc">$</span>nrow)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>test_state <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">seq_len</span>(state_task<span class="sc">$</span>nrow), train_state)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>learner_state <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>, <span class="at">nthread =</span> <span class="dv">7</span>, <span class="at">eta =</span> .<span class="dv">1</span>, <span class="at">nrounds =</span> <span class="dv">25</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>learner_state<span class="sc">$</span><span class="fu">train</span>(state_task, <span class="at">row_ids =</span> train_state) <span class="co"># error</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>prediction_state <span class="ot">&lt;-</span> learner_state<span class="sc">$</span><span class="fu">predict</span>(state_task, <span class="at">row_ids =</span> test_state)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>prediction_state<span class="sc">$</span>confusion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response ID IL IN MA ME NM NY PA TX
      ID  0  0  0  0  0  0  0  0  0
      IL  0  4  0  1  0  0  0  0  0
      IN  0  0  2  0  0  0  2  0  0
      MA  0  0  0  0  0  0  1  0  0
      ME  0  0  0  1  0  0  0  0  0
      NM  0  0  0  1  0  1  3  1  0
      NY  2  1  0  1  1  0  7  0  0
      PA  0  0  0  0  0  0  1  6  0
      TX  0  0  0  0  0  0  0  1 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">&lt;-</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>prediction_state<span class="sc">$</span><span class="fu">score</span>(measure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
  0.6530612 </code></pre>
</div>
</div>
</section>
<section id="add-explanatory-power" class="level2">
<h2 class="anchored" data-anchor-id="add-explanatory-power">Add Explanatory Power</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>state_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">state =</span> congress_df<span class="sc">$</span>Latest_State, </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">text =</span> congress_df<span class="sc">$</span>text)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>predictorText <span class="ot">&lt;-</span> <span class="fu">textProcessor</span>(<span class="at">documents =</span> state_df<span class="sc">$</span>text, </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">metadata =</span> state_df, </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">stem =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Building corpus... 
Converting to Lower Case... 
Removing punctuation... 
Removing stopwords... 
Removing numbers... 
Creating Output... </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>textPrep <span class="ot">&lt;-</span> <span class="fu">prepDocuments</span>(<span class="at">documents =</span> predictorText<span class="sc">$</span>documents, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">vocab =</span> predictorText<span class="sc">$</span>vocab,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">meta =</span> predictorText<span class="sc">$</span>meta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Removing 873 of 1516 terms (873 of 8942 tokens) due to frequency 
Your corpus now has 241 documents, 643 terms and 8069 tokens.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>topicPredictor <span class="ot">&lt;-</span> <span class="fu">stm</span>(<span class="at">documents =</span> textPrep<span class="sc">$</span>documents,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">vocab =</span> textPrep<span class="sc">$</span>vocab, <span class="at">prevalence =</span> <span class="sc">~</span> state,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> textPrep<span class="sc">$</span>meta, <span class="at">K =</span> <span class="dv">10</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>stateEffect <span class="ot">&lt;-</span> <span class="fu">estimateEffect</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">~</span> state, <span class="at">stmobj =</span> topicPredictor,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">metadata =</span> textPrep<span class="sc">$</span>meta)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stateEffect, <span class="at">topics =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
estimateEffect(formula = 1:10 ~ state, stmobj = topicPredictor, 
    metadata = textPrep$meta)


Topic 1:

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.11846    0.09802   1.209 0.228073    
stateIL     -0.11492    0.10375  -1.108 0.269136    
stateIN     -0.11413    0.10718  -1.065 0.288058    
stateMA     -0.11010    0.11101  -0.992 0.322351    
stateME     -0.11061    0.12948  -0.854 0.393844    
stateNM     -0.11461    0.11444  -1.001 0.317637    
stateNY     -0.10123    0.10114  -1.001 0.317880    
statePA     -0.10043    0.10443  -0.962 0.337240    
stateTX      0.35643    0.10504   3.393 0.000812 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Topic 2:

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)  0.02347    0.09743   0.241   0.8098  
stateIL     -0.01664    0.10441  -0.159   0.8735  
stateIN     -0.01957    0.10824  -0.181   0.8567  
stateMA     -0.01621    0.11358  -0.143   0.8866  
stateME      0.22758    0.16017   1.421   0.1567  
stateNM     -0.01650    0.11700  -0.141   0.8880  
stateNY      0.18680    0.10517   1.776   0.0770 .
statePA      0.24768    0.10986   2.255   0.0251 *
stateTX      0.01440    0.10057   0.143   0.8863  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Topic 3:

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.0125054  0.0680829   0.184    0.854    
stateIL      0.6001274  0.0844229   7.109 1.44e-11 ***
stateIN      0.0773706  0.0804903   0.961    0.337    
stateMA      0.0331224  0.0803881   0.412    0.681    
stateME     -0.0102424  0.0938958  -0.109    0.913    
stateNM     -0.0090835  0.0807301  -0.113    0.911    
stateNY     -0.0074344  0.0710861  -0.105    0.917    
statePA     -0.0075973  0.0727101  -0.104    0.917    
stateTX     -0.0001451  0.0703711  -0.002    0.998    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Topic 4:

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.026453   0.072343   0.366    0.715    
stateIL      0.009286   0.078556   0.118    0.906    
stateIN     -0.021864   0.080594  -0.271    0.786    
stateMA      0.654027   0.103456   6.322 1.31e-09 ***
stateME      0.035125   0.110900   0.317    0.752    
stateNM     -0.019635   0.087395  -0.225    0.822    
stateNY      0.056286   0.077535   0.726    0.469    
statePA      0.031923   0.078816   0.405    0.686    
stateTX      0.008603   0.075703   0.114    0.910    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Topic 5:

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.023525   0.069747   0.337    0.736    
stateIL     -0.019570   0.074929  -0.261    0.794    
stateIN     -0.019056   0.076074  -0.250    0.802    
stateMA     -0.018215   0.079977  -0.228    0.820    
stateME     -0.016869   0.096573  -0.175    0.861    
stateNM      0.597730   0.122241   4.890 1.89e-06 ***
stateNY      0.039542   0.074047   0.534    0.594    
statePA     -0.006305   0.074925  -0.084    0.933    
stateTX      0.055411   0.074137   0.747    0.456    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Topic 6:

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.5927     0.1241   4.774  3.2e-06 ***
stateIL      -0.4436     0.1329  -3.337 0.000987 ***
stateIN      -0.3927     0.1437  -2.732 0.006784 ** 
stateMA      -0.5346     0.1424  -3.754 0.000220 ***
stateME      -0.1852     0.1706  -1.086 0.278677    
stateNM      -0.4808     0.1435  -3.351 0.000939 ***
stateNY      -0.4380     0.1269  -3.452 0.000661 ***
statePA      -0.4724     0.1293  -3.652 0.000321 ***
stateTX      -0.4998     0.1273  -3.927 0.000114 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Topic 7:

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)  0.053073   0.106642   0.498   0.6192  
stateIL      0.012723   0.114789   0.111   0.9118  
stateIN     -0.032992   0.119277  -0.277   0.7823  
stateMA      0.076296   0.124358   0.614   0.5401  
stateME     -0.046454   0.142312  -0.326   0.7444  
stateNM      0.103356   0.144510   0.715   0.4752  
stateNY      0.051428   0.111838   0.460   0.6461  
statePA      0.256619   0.122548   2.094   0.0373 *
stateTX      0.001537   0.109604   0.014   0.9888  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Topic 8:

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)  0.08026    0.11078   0.725    0.469
stateIL     -0.02048    0.11661  -0.176    0.861
stateIN     -0.03614    0.12232  -0.295    0.768
stateMA     -0.02599    0.12718  -0.204    0.838
stateME      0.16632    0.15582   1.067    0.287
stateNM     -0.02097    0.12968  -0.162    0.872
stateNY      0.17230    0.11406   1.511    0.132
statePA      0.02950    0.12259   0.241    0.810
stateTX     -0.04275    0.11304  -0.378    0.706


Topic 9:

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.02231    0.08086   0.276    0.783    
stateIL      0.02760    0.08730   0.316    0.752    
stateIN      0.60080    0.09938   6.045  5.9e-09 ***
stateMA     -0.01762    0.09345  -0.189    0.851    
stateME     -0.01775    0.11207  -0.158    0.874    
stateNM     -0.01792    0.09636  -0.186    0.853    
stateNY      0.07136    0.08527   0.837    0.403    
statePA      0.04200    0.08678   0.484    0.629    
stateTX      0.02586    0.08533   0.303    0.762    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


Topic 10:

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)  0.04887    0.07442   0.657    0.512
stateIL     -0.03567    0.07901  -0.451    0.652
stateIN     -0.04295    0.08162  -0.526    0.599
stateMA     -0.04311    0.08297  -0.520    0.604
stateME     -0.04194    0.09484  -0.442    0.659
stateNM     -0.01901    0.08913  -0.213    0.831
stateNY     -0.03140    0.07729  -0.406    0.685
statePA     -0.02198    0.07923  -0.277    0.782
stateTX      0.07899    0.07715   1.024    0.307</code></pre>
</div>
</div>
<p>Behold! For the probably, most ugly viz you will see. The limit of computers is unlimited.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">1</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">2</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">3</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">4</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">5</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">6</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">7</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-7.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">8</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-8.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">9</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-9.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.estimateEffect</span>(stateEffect, <span class="st">"state"</span>, <span class="at">method =</span> <span class="st">"pointestimate"</span>,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> topicPredictor, <span class="at">topics =</span> <span class="dv">10</span>, <span class="at">labeltype =</span> <span class="st">"frex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Homework-3_files/figure-html/unnamed-chunk-18-10.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>